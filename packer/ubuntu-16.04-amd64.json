{
  "variables": {
    "name": "ubuntu-16.04-amd64",
    "description": "Ubuntu 16.04 x86_64 (amd64)",
    "version": "",
    "releases_mirror": "releases.ubuntu.com",
    "archive_mirror": "archive.ubuntu.com",
    "build_number": "{{env `BUILD_NUMBER`}}",
    "triton_account": "",
    "triton_key_id": ""
  },
  "builders": [
    {
      "type": "triton",
      "triton_account": "{{user `triton_account`}}",
      "triton_key_id": "{{user `triton_key_id`}}",
      "source_machine_package": "g4-highcpu-128M",
      "source_machine_image_filter": {
        "name": "ubuntu-16.04",
        "most_recent": "true"
      },
      "ssh_username": "root",
      "image_version": "{{user `version`}}",
      "image_name": "{{user `name`}}",
      "image_tags": {
        "Name": "{{user `name`}}",
        "Description": "{{user `description`}}",
        "Version": "{{user `version`}}",
        "CreationDate": "{{isotime \"Mon Jan _2 15:04:05 UTC 2006\"}}"
      }
    }
  ],
  "provisioners": [
    {
      "type": "file",
      "source": "scripts/helpers",
      "destination": "/var/tmp"
    },
    {
      "type": "file",
      "source": "files/common",
      "destination": "/var/tmp"
    },
    {
      "type": "shell",
      "environment_vars": [
        "ARCHIVE_MIRROR=http://{{user `archive_mirror`}}/ubuntu",
        "BUILD_NUMBER={{user `build_number`}}",
        "PACKER_BUILD_NAME={{user `name`}}",
        "PACKER_BUILD_TIMESTAMP={{timestamp}}",
        "PACKER_BUILD_VERSION={{user `version`}}"
      ],
      "execute_command": "{{ .Vars }} sudo -H -S -E -n bash '{{ .Path }}'",
      "expect_disconnect": "true",
      "scripts": [
        "scripts/common/update.sh",
        "scripts/common/packages.sh",
        "scripts/common/sshd.sh",
        "scripts/common/reboot.sh",
        "scripts/common/disable-ipv6.sh",
        "scripts/common/networking.sh",
        "scripts/common/clean-up.sh"
      ]
    }
  ]
}
