{
  "variables": {
    "name": "nomad-client",
    "description": "",
    "nomad_version": "",
    "nomad_deployment_type": "",
    "triton_account": "{{env `TRITON_ACCOUNT`}}",
    "triton_key_id": "{{env `TRITON_KEY_ID`}}",
    "source_machine_image": "",
    "source_machine_image_version": "",
    "source_machine_package": "k4-general-kvm-3.75G"
  },
  "builders": [
    {
      "type": "triton",
      "triton_account": "{{user `triton_account`}}",
      "triton_key_id": "{{user `triton_key_id`}}",
      "source_machine_package": "{{user `source_machine_package`}}",
      "source_machine_image_filter": {
        "name": "{{user `source_machine_image`}}",
        "version": "{{user `source_machine_image_version`}}",
        "most_recent": "true"
      },
      "ssh_username": "ubuntu",
      "image_version": "{{user `nomad_version`}}",
      "image_name": "{{user `name`}}",
      "image_description": "{{user `description`}}",
      "image_tags": {
        "name": "{{user `name`}}",
        "description": "{{user `description`}}",
        "version": "{{user `nomad_version`}}",
        "creation_date": "{{isotime \"Mon Jan _2 15:04:05 UTC 2006\"}}",
        "role": "os",
        "default_user": "ubuntu"
      }
    }
  ],
  "provisioners": [
    {
      "type": "file",
      "source": "files/nomad/{{user `nomad_deployment_type`}}/",
      "destination": "/tmp"
    },
    {
      "type": "shell",
      "execute_command": "{{ .Vars }} sudo -H -S -E -n bash '{{ .Path }}'",
      "scripts": [
        "scripts/nomad/packages.sh"
      ]
    }
  ]
}
